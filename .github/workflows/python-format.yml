name: autoblack
on: [pull_request]

jobs:
  autoblack:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v2
        with:
          repository: ${{ github.event.pull_request.head.repo.full_name }}
          ref: ${{ github.event.pull_request.head.ref }}
      - name: Set up Python 3.8
        uses: actions/setup-python@v1
        with:
          python-version: 3.8
      - name: Install Black
        run: pip install black
      - name: Run black
        run: black .
      - name: Commit black changes to the pull request
        uses: EndBug/add-and-commit@v9.0.0
        with:
          author_name: electricitymap
          author_email: eng@electricitymap.org
          message: 'Automatic black formatting'
          add: '*.py'



  autoisort:
      runs-on: ubuntu-latest
      needs: [autoblack]
      steps:
        - name: Checkout repo
          uses: actions/checkout@v2
          with:
            repository: ${{ github.event.pull_request.head.repo.full_name }}
            ref: ${{ github.event.pull_request.head.ref }}
        - name: Set up Python 3.8
          uses: actions/setup-python@v1
          with:
            python-version: 3.8
        - name: Install isort
          run: pip install isort
        - name: Run isort
          run: isort --profile=black --known-local-folder=electricitymap --known-local-folder=parsers --known-local-folder=scripts --known-local-folder=tests
        - name: Commit isort changes to the pull request
          uses: EndBug/add-and-commit@v9.0.0
          with:
            author_name: electricitymap
            author_email: eng@electricitymap.org
            message: 'Automatic black formatting'
            add: '*.py'
